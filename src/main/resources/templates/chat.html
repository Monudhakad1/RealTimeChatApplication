<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Real-Time Chat Application</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.1/stomp.min.js"></script>
    <style>
        .chat-messages {
            height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body class="bg-light">
<div class="container mt-4">
    <div class="mx-auto" style="max-width: 800px;">
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white py-3">
                <h2 class="text-center h4 mb-1">Real-Time Chat</h2>
                <div class="text-center small">ðŸŸ¢ <span class="online-status">Connected</span></div>
            </div>

            <div class="card-body p-4">
                <div class="mb-3">
                    <div class="input-group">
                        <input id="senderInput" type="text" class="form-control rounded-pill" placeholder="Enter your name to start chatting...">
                    </div>
                </div>

                <div id="chat" class="chat-messages bg-light p-3 rounded mb-3"></div>

                <div class="mt-3">
                    <div class="input-group">
                        <input id="messageInput" type="text" class="form-control rounded-pill" placeholder="Type your message here...">
                        <button id="sendMessage" class="btn btn-primary rounded-pill ms-2 px-4">
                            Send âž¤
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


</body>
<script>
    let stompClient = null;

    function setConnected(connected) {
        document.getElementById('sendMessage').disabled = !connected;
        const status = document.querySelector('.online-status');
        if (connected) {
            status.innerHTML = 'ðŸŸ¢ Connected';
            status.style.color = '#28a745';
        } else {
            status.innerHTML = 'ðŸ”´ Disconnected';
            status.style.color = '#dc3545';
        }
    }

    function connect() {
        const socket = new SockJS('/chat');
        stompClient = Stomp.over(socket);
        stompClient.connect({}, function (frame) {
            setConnected(true);
            stompClient.subscribe('/topic/messages', function (message) {
                showMessage(JSON.parse(message.body));
            });
        }, function(error) {
            setConnected(false);
            setTimeout(connect, 5000); // Try to reconnect after 5 seconds
        });
    }

    function showMessage(message) {
        const chat = document.getElementById('chat');
        const messageDiv = document.createElement('div');
        messageDiv.className = 'mb-3';

        const senderName = document.createElement('div');
        senderName.className = 'fw-bold text-primary small mb-1';
        senderName.textContent = message.sender;

        const messageContent = document.createElement('div');
        messageContent.className = 'bg-white p-3 rounded shadow-sm d-inline-block';
        messageContent.style.maxWidth = '80%';
        messageContent.textContent = message.content;

        messageDiv.appendChild(senderName);
        messageDiv.appendChild(messageContent);
        chat.appendChild(messageDiv);
        chat.scrollTop = chat.scrollHeight;
    }

    function sendMessage() {
        const sender = document.getElementById('senderInput').value.trim();
        const content = document.getElementById('messageInput').value.trim();

        if (!sender) {
            alert('Please enter your name first!');
            document.getElementById('senderInput').focus();
            return;
        }

        if (!content) {
            return;
        }

        const chatMessage = {
            sender: sender,
            content: content
        };

        stompClient.send("/app/sendMessage", {}, JSON.stringify(chatMessage));
        document.getElementById('messageInput').value = '';
    }

    // Event Listeners
    document.getElementById('sendMessage').addEventListener('click', sendMessage);
    document.getElementById('messageInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            sendMessage();
        }
    });

    // Disable send button if name is not entered
    document.getElementById('senderInput').addEventListener('input', function(e) {
        const sendButton = document.getElementById('sendMessage');
        sendButton.disabled = !e.target.value.trim();
    });

    window.onload = connect;

</script>
</html>